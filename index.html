<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Date Finder</title>
<style>
    :root {
        --primary: #2d3436;
        --accent: #0984e3;
        --danger: #d63031;
        --success: #00b894;
        --bg: #f5f6fa;
    }
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background-color: var(--bg);
        display: flex;
        justify-content: center;
        padding: 20px;
        margin: 0;
    }
    .wizard-card {
        background: white;
        width: 100%;
        max-width: 700px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 550px;
    }
    
    .wizard-header {
        padding: 20px 30px;
        background: white;
        border-bottom: 1px solid #eee;
    }
    .progress-bar {
        height: 6px;
        background: #eee;
        border-radius: 3px;
        margin-top: 15px;
        overflow: hidden;
    }
    .progress-fill {
        height: 100%;
        background: var(--accent);
        width: 10%;
        transition: width 0.3s ease;
    }

    .step-content {
        padding: 30px;
        flex: 1;
        display: none; 
    }
    .step-content.active {
        display: block;
        animation: fadeIn 0.4s;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
    }

    h2 { margin-top: 0; color: var(--primary); }
    p { color: #636e72; line-height: 1.5; }

    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; font-weight: 600; color: #2d3436; }
    input[type="date"] {
        padding: 10px; border: 1px solid #dfe6e9; border-radius: 6px; width: 100%; font-size: 16px;
        font-family: inherit;
    }
    .blocked-list {
        margin-top: 10px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }
    .blocked-tag {
        background: #ffeaa7;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    .blocked-tag span { cursor: pointer; font-weight: bold; color: var(--danger); }
    
    .weekdays-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
        gap: 10px;
    }
    .weekday-check {
        border: 1px solid #dfe6e9;
        padding: 10px;
        text-align: center;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
        font-weight: 500;
    }
    .weekday-check.selected {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
    }

    .wizard-footer {
        padding: 20px 30px;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        background: #fff;
    }
    button {
        padding: 12px 24px;
        border-radius: 8px;
        border: none;
        font-size: 16px;
        cursor: pointer;
        font-weight: 600;
        transition: 0.2s;
    }
    .btn-next { background: var(--primary); color: white; }
    .btn-next:hover { background: #000; }
    .btn-prev { background: #dfe6e9; color: #2d3436; }
    .btn-prev:hover { background: #b2bec3; }
    .btn-add { background: #fdcb6e; color: #2d3436; margin-top: 10px; width: 100%; }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
        margin-top: 20px;
    }
    .cal-header {
        text-align: center;
        font-weight: bold;
        font-size: 12px;
        color: #b2bec3;
        padding-bottom: 5px;
    }
    .cal-day {
        aspect-ratio: 1;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        position: relative;
        border: 1px solid #eee;
    }
    .cal-day.empty { background: transparent; border: none; }
    .cal-day.good { background: var(--success); color: white; font-weight: bold; box-shadow: 0 2px 5px rgba(0,184,148,0.3); }
    .cal-day.bad { background: #ff7675; color: white; opacity: 0.4; cursor: not-allowed; }
    .cal-day.bad:hover::after {
        content: attr(data-reason);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: #333;
        color: white;
        padding: 5px;
        border-radius: 4px;
        font-size: 10px;
        white-space: nowrap;
        z-index: 10;
        pointer-events: none;
    }
    .legend {
        display: flex;
        gap: 15px;
        margin-top: 15px;
        font-size: 12px;
        justify-content: center;
    }
    .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
</style>
</head>
<body>

<div class="wizard-card">
    <div class="wizard-header">
        <h3 style="margin:0;">Perfect Date Finder</h3>
        <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
    </div>

    <div class="step-content active" id="step1">
        <h2>Step 1: General Timeframe</h2>
        <p>Specify the date range (season) in which the event should theoretically take place.</p>
        <div class="form-group">
            <label>Start Date:</label>
            <input type="date" id="startDate">
        </div>
        <div class="form-group">
            <label>End Date:</label>
            <input type="date" id="endDate">
        </div>
    </div>

    <div class="step-content" id="step2">
        <h2>Steps 2-3: External Constraints</h2>
        <p>Add dates of Public Holidays, City Events, or potential Strikes to the block list.</p>
        <div class="form-group">
            <input type="date" id="blockDateInput_2">
            <button class="btn-add" onclick="addBlockDate(2, 'Holiday/External Risk')">Block Date</button>
            <div class="blocked-list" id="blockedList_2"></div>
        </div>
    </div>

    <div class="step-content" id="step3">
        <h2>Step 4: Key Resources</h2>
        <p>Are your Key Speakers or Venue unavailable on certain days? Block them here.</p>
        <div class="form-group">
            <input type="date" id="blockDateInput_3">
            <button class="btn-add" onclick="addBlockDate(3, 'Venue/Speaker Unavailable')">Block Date</button>
            <div class="blocked-list" id="blockedList_3"></div>
        </div>
    </div>

    <div class="step-content" id="step4">
        <h2>Steps 5-6: Market & Team</h2>
        <p>Exclude dates with Competing Events or when your Team is busy/on vacation.</p>
        <div class="form-group">
            <input type="date" id="blockDateInput_4">
            <button class="btn-add" onclick="addBlockDate(4, 'Competitor/Team Busy')">Block Date</button>
            <div class="blocked-list" id="blockedList_4"></div>
        </div>
    </div>

    <div class="step-content" id="step5">
        <h2>Step 7: Audience Preferences</h2>
        <p>Select the weekdays that suit your audience. Unsuitable days will be removed.</p>
        <div class="weekdays-grid">
            <div class="weekday-check selected" onclick="toggleDay(this, 1)">Mon</div>
            <div class="weekday-check selected" onclick="toggleDay(this, 2)">Tue</div>
            <div class="weekday-check selected" onclick="toggleDay(this, 3)">Wed</div>
            <div class="weekday-check selected" onclick="toggleDay(this, 4)">Thu</div>
            <div class="weekday-check selected" onclick="toggleDay(this, 5)">Fri</div>
            <div class="weekday-check selected" onclick="toggleDay(this, 6)">Sat</div>
            <div class="weekday-check selected" onclick="toggleDay(this, 0)">Sun</div>
        </div>
    </div>

    <div class="step-content" id="step6">
        <h2>Final Calendar</h2>
        <p>Green dates are your perfect candidates. Hover over red dates to see why they were blocked.</p>
        
        <div id="calendarContainer"></div>
        
        <div class="legend">
            <div><span class="dot" style="background:var(--success)"></span>Perfect Date</div>
            <div><span class="dot" style="background:#ff7675"></span>Blocked</div>
        </div>
    </div>

    <div class="wizard-footer">
        <button class="btn-prev" id="prevBtn" onclick="changeStep(-1)" disabled>Back</button>
        <button class="btn-next" id="nextBtn" onclick="changeStep(1)">Next</button>
    </div>
</div>

<script>
    let currentStep = 1;
    const totalSteps = 6;
    
    // Data Storage
    let blockedDates = {}; // Format: "YYYY-MM-DD": "Reason"
    let allowedWeekdays = [0,1,2,3,4,5,6]; // All allowed by default

    function changeStep(n) {
        // Validation for Step 1
        if (currentStep === 1 && n === 1) {
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;
            if(!start || !end) return alert("Please select a Start and End date.");
            if(start > end) return alert("Start date cannot be after End date.");
        }

        document.getElementById(`step${currentStep}`).classList.remove('active');
        currentStep += n;
        document.getElementById(`step${currentStep}`).classList.add('active');
        
        // Update Buttons & Progress
        document.getElementById('prevBtn').disabled = (currentStep === 1);
        
        const nextBtn = document.getElementById('nextBtn');
        if (currentStep === totalSteps) {
            nextBtn.style.display = 'none';
            renderFinalCalendar();
        } else {
            nextBtn.style.display = 'block';
            nextBtn.innerText = 'Next';
        }
        
        let progress = ((currentStep - 1) / (totalSteps - 1)) * 100;
        document.getElementById('progress').style.width = `${progress}%`;
    }

    function addBlockDate(stepId, defaultReason) {
        const input = document.getElementById(`blockDateInput_${stepId}`);
        const date = input.value;
        if (!date) return;

        blockedDates[date] = defaultReason;

        const list = document.getElementById(`blockedList_${stepId}`);
        const tag = document.createElement('div');
        tag.className = 'blocked-tag';
        tag.innerHTML = `${date} <span onclick="removeDate(this, '${date}')">&times;</span>`;
        list.appendChild(tag);
        
        input.value = '';
    }

    function removeDate(el, date) {
        delete blockedDates[date];
        el.parentElement.remove();
    }

    function toggleDay(el, dayIndex) {
        el.classList.toggle('selected');
        if (allowedWeekdays.includes(dayIndex)) {
            allowedWeekdays = allowedWeekdays.filter(d => d !== dayIndex);
        } else {
            allowedWeekdays.push(dayIndex);
        }
    }

    function renderFinalCalendar() {
        const startStr = document.getElementById('startDate').value;
        const endStr = document.getElementById('endDate').value;
        const container = document.getElementById('calendarContainer');
        container.innerHTML = ''; 

        let current = new Date(startStr);
        const end = new Date(endStr);

        const daysEn = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat']; // Eng headers
        
        let html = '<div class="calendar-grid">';
        daysEn.forEach(d => html += `<div class="cal-header">${d}</div>`);
        
        // Fill empty slots for first week align (Sunday based for EN usually, but let's stick to Sun=0)
        let firstDayOfWeek = current.getDay(); 
        // Logic: if loop starts at Sun (0), we need 0 empty slots.
        for(let i=0; i<firstDayOfWeek; i++) html += `<div class="cal-day empty"></div>`;

        while (current <= end) {
            const dateStr = current.toISOString().split('T')[0];
            const dayOfWeek = current.getDay(); 
            const dayNum = current.getDate();
            
            let isBad = false;
            let reason = '';

            if (blockedDates[dateStr]) {
                isBad = true;
                reason = blockedDates[dateStr];
            }
            else if (!allowedWeekdays.includes(dayOfWeek)) {
                isBad = true;
                reason = 'Weekday excluded';
            }

            if (isBad) {
                html += `<div class="cal-day bad" data-reason="${reason}">${dayNum}</div>`;
            } else {
                html += `<div class="cal-day good">${dayNum}</div>`;
            }

            current.setDate(current.getDate() + 1);
        }
        
        html += '</div>';
        container.innerHTML = html;
    }
</script>

</body>
</html>
